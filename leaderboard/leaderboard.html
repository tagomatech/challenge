<!-- View file using: https://htmlpreview.github.io/?https://github.com/q-variance/challenge/blob/main/leaderboard/leaderboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Variance Challenge Leaderboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
        h1 { color: #d9534f; text-align: center; }
        p { text-align: center; font-size: 14px; color: #333; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background-color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #d9534f; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .passed { background-color: #d4edda; }
        .failed { background-color: #f8d7da; }
        .loading { text-align: center; color: #6c757d; font-style: italic; }
        .error { color: #dc3545; text-align: center; font-weight: bold; }
        .no-subs { text-align: center; color: #6c757d; font-style: italic; }
    </style>
</head>
<body>
    <h1>Q-Variance Challenge Leaderboard</h1>
    <p>Target: Global R² ≥ 0.92 using ≤2 free parameters (continuous-time models only)</p>
    
    <table id="leaderboard">
        <thead>
            <tr>
                <th>Rank</th>
                <th>Submission</th>
                <th>Author</th>
                <th>R²</th>
                <th>Params</th>
                <th>Status</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <tr><td colspan="7" class="loading">Loading submissions from GitHub API...</td></tr>
        </tbody>
    </table>

    <script>
        async function loadSubmissions() {
            const body = document.getElementById('table-body');
            body.innerHTML = '<tr><td colspan="7" class="loading">Fetching submissions...</td></tr>';
            
            // Fallback hardcoded rows (if API fails)
            const fallbackRows = [
                { name: 'Quantum Baseline', author: 'David Orrell', r2: 0.9528, params: 1, status: 'Passed', date: '2025-07-01' },
                { name: 'Grok Rough Vol', author: 'Grok (xAI)', r2: 0.8545, params: 4, status: 'Failed', date: '2025-11-21' }
            ];
            
            try {
                // Fetch submissions folder via GitHub API
                const response = await fetch('https://api.github.com/repos/q-variance/challenge/contents/submissions?ref=main');
                if (!response.ok) throw new Error('API failed');
                const dirs = await response.json();
                
                const submissions = [];
                
                for (const dir of dirs) {
                    if (dir.type !== 'dir') continue;
                    const subName = dir.name;
                    
                    // Fetch README.md
                    const readmeResponse = await fetch(`https://api.github.com/repos/q-variance/challenge/contents/submissions/${subName}/README.md?ref=main`);
                    if (!readmeResponse.ok) continue;
                    const readme = await readmeResponse.json();
                    const readmeContent = atob(readme.content);
                    
                    // Parse R² and params from README (simple regex)
                    const r2Match = readmeContent.match(/R²[:\s]*([0-9.]+)/i);
                    const paramsMatch = readmeContent.match(/Params[:\s]*([0-9]+)/i);
                    const r2 = r2Match ? parseFloat(r2Match[1]) : 0;
                    const params = paramsMatch ? parseInt(paramsMatch[1]) : 'N/A';
                    
                    submissions.push({
                        name: subName,
                        r2: r2,
                        params: params,
                        date: readme.sha.substring(0,10)  # Use commit hash as date proxy
                    });
                }
                
                // Sort by R² descending
                submissions.sort((a, b) => b.r2 - a.r2);
                
                if (submissions.length === 0) {
                    renderTable(fallbackRows);
                    return;
                }
                
                renderTable(submissions);
            } catch (error) {
                console.error('Load error:', error);
                body.innerHTML = '<tr><td colspan="7" class="error">API error—using fallback data.</td></tr>';
                renderTable(fallbackRows);
            }
        }
        
        function renderTable(rows) {
            const body = document.getElementById('table-body');
            body.innerHTML = '';
            
            rows.forEach((row, index) => {
                const status = row.r2 >= 0.92 ? 'Passed' : 'Failed';
                const rowClass = status === 'Passed' ? 'passed' : 'failed';
                body.innerHTML += `
                    <tr class="${rowClass}">
                        <td>${index + 1}</td>
                        <td>${row.name}</td>
                        <td>${row.author || 'Unknown'}</td>
                        <td>${row.r2.toFixed(4)}</td>
                        <td>${row.params}</td>
                        <td>${status}</td>
                        <td>${row.date}</td>
                    </tr>
                `;
            });
            
            if (rows.length === 0) {
                body.innerHTML = '<tr><td colspan="7" class="no-subs">No submissions yet. Be the first!</td></tr>';
            }
        }
        
        // Load on page load
        window.onload = loadSubmissions;
    </script>
</body>
</html>
